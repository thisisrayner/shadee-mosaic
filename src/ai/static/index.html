<!DOCTYPE html>
<!-- 
  Shadee Mosaic - Internal Brain Explorer
  
  Architecture:
  - This is a "Declarative View" file; it contains only HTML structure and inline styles (Tailwind-like).
  - All logic is modularized in src/ai/static/js/modules/
  - Main entry point: src/ai/static/js/modules/main.js
-->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shade-Intelligence: Internal Brain Explorer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Outfit:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="ambient-glow"></div>

    <div class="container">
        <header>
            <h1>Shadee.Care: Project MosAIc</h1>
            <p class="subtitle">INTERNAL BRAIN EXPLORER</p>
        </header>

        <div class="search-container">
            <input type="text" id="queryInput" placeholder="Describe a theme (e.g. academic stress among youth)..."
                autocomplete="off">
            <button class="search-btn">Search</button>
        </div>

        <div class="search-controls">
            <label class="toggle-switch">
                <input type="checkbox" id="aiOnlyToggle" checked>
                <div class="toggle-slider"></div>
                <span id="toggleLabel" style="font-size: 0.8rem;">Verified posts only</span>
            </label>
            <div class="tooltip">
                <span class="tooltip-icon">i</span>
                <span class="tooltiptext">
                    <strong>ON:</strong> Only show high-fidelity AI verified narratives.<br>
                    <strong>OFF:</strong> Include all records including baseline Regex results.
                </span>
            </div>

            <label class="toggle-switch" style="margin-left: 2rem;">
                <input type="checkbox" id="sgOnlyToggle">
                <div class="toggle-slider"></div>
                <span id="sgToggleLabel" style="font-size: 0.8rem;">Whole DB</span>
            </label>
            <div class="tooltip">
                <span class="tooltip-icon">i</span>
                <span class="tooltiptext">
                    <strong>ON:</strong> Show results from Singapore-based posts only.<br>
                    <strong>OFF:</strong> Show results from the entire database (Global + SG).
                </span>
            </div>
        </div>

        <div class="loader" id="loader"></div>

        <div id="results-area" style="display: none;">
            <div class="tabs">
                <div class="tab active" data-tab="synthesis">AI Synthesis</div>
                <div class="tab" data-tab="evidence">Evidence Audit</div>
                <div class="tab" data-tab="protocol">Protocol Trace</div>
            </div>

            <!-- Tab 1: Synthesis -->
            <div id="synthesis-tab" class="tab-content active">
                <div id="trends-container"
                    style="background: rgba(15, 23, 42, 0.4); border: 1px solid rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 1.5rem; margin-bottom: 2rem; display: none;">
                    <h3 style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                        <span style="color: #6366f1;">Atmosphere Pulse</span>
                        <span style="font-size: 0.8rem; font-weight: normal; opacity: 0.7;">(Last 180 Days)</span>
                        <div class="tooltip" style="margin-left: auto;">
                            <span class="tooltip-icon" style="width: 1rem; height: 1rem; font-size: 0.7rem;">?</span>
                            <span class="tooltiptext">
                                <strong>0-100 Index:</strong> Represents search interest relative to the highest point
                                on the chart for the given region and time. A value of 100 is the peak popularity for
                                the term.
                            </span>
                        </div>
                    </h3>
                    <div style="position: relative; height: 180px;">
                        <canvas id="trendsChart"></canvas>
                    </div>
                </div>
                <div id="ai-response" class="glass-container"
                    style="padding: 2rem; min-height: 200px; position: relative;">
                    <div id="research-trace"
                        style="display: none; margin-bottom: 2rem; border-left: 2px solid #6366f1; padding-left: 1.5rem;">
                        <div id="trace-logs"
                            style="font-family: monospace; font-size: 0.85rem; color: #94a3b8; line-height: 1.6;"></div>
                    </div>
                    <div id="synthesis-text">Initiating research protocol...</div>

                    <div class="follow-up-box" id="follow-up-ui" style="display: none;">
                        <input type="text" id="followUpInput" placeholder="Ask a follow-up about these insights...">
                        <button class="search-btn" style="position:static; padding: 0.75rem 1.5rem;"
                            onclick="handleFollowUp()">Ask</button>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Evidence -->
            <div id="evidence-tab" class="tab-content">
                <div id="stats-banner-container"></div>
                <div id="results"></div>
            </div>

            <!-- Tab 3: Protocol -->
            <div id="protocol-tab" class="tab-content">
                <div id="protocol-log"
                    style="font-family: 'Fira Code', monospace; font-size: 0.85rem; background: #000; border: 1px solid #333; height: 600px; overflow-y: auto; padding: 1.5rem; border-radius: 1rem; color: #94a3b8; line-height: 1.6;">
                    <div style="color: #6d6d6d;">> Awaiting clinical protocol initiation...</div>
                </div>
            </div>
        </div>

        <div id="initial-state" class="empty-state">Enter a query to explore the narratives...</div>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <span id="modalPlatform" class="platform-tag">PLATFORM</span>
                    <h2 id="modalHeaderTitle" style="margin-top: 0.5rem;">Post Details</h2>
                </div>
                <button class="close-btn">✕</button>
            </div>
            <div class="modal-body">
                <span class="section-label">Anonymized Narrative</span>
                <div id="modalContentScrubbed" class="content-block"></div>

                <div class="warning-box">
                    <span>⚠️</span>
                    <span><strong>Internal Only:</strong> Original content shown below may contain PII. Handle with
                        clinical discretion.</span>
                </div>

                <span class="section-label">Original Content</span>
                <div id="modalContentOriginal" class="content-block" style="color: var(--text-secondary);"></div>

                <span class="section-label">Classification Metadata</span>
                <div class="meta-grid">
                    <div class="meta-item">
                        <span class="meta-key">Post Date</span>
                        <div id="metaDate" class="meta-value">N/A</div>
                    </div>
                    <div class="meta-item">
                        <span class="meta-key">Classification Tier</span>
                        <div id="metaTier" class="meta-value">N/A</div>
                    </div>
                    <div class="meta-item">
                        <span class="meta-key">Confidence Score</span>
                        <div id="metaSimilarity" class="meta-value">N/A</div>
                    </div>
                    <div class="meta-item" style="grid-column: 1 / -1;">
                        <span class="meta-key">AI Explanation (if available)</span>
                        <div id="metaAiExplanation" class="meta-value" style="font-weight: 400; line-height: 1.5;">N/A
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="./js/modules/main.js"></script>
</body>

</html>